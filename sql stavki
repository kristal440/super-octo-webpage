-- USERS TABLE
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    status VARCHAR(20) NOT NULL CHECK (status IN ('Student', 'Teacher', 'Admin'))
);

-- SUBJECTS TABLE
CREATE TABLE subjects (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    teacher_id INTEGER,
    access_key CHAR(6),
    FOREIGN KEY (teacher_id) REFERENCES users(id) ON DELETE SET NULL
);

-- USER-SUBJECTS (ENROLLMENTS) TABLE
CREATE TABLE user_subjects (
    id SERIAL PRIMARY KEY,
    user_id INTEGER NOT NULL,
    subject_id INTEGER NOT NULL,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (subject_id) REFERENCES subjects(id) ON DELETE CASCADE
);

-- MATERIALS TABLE (for uploaded files/resources)
CREATE TABLE materials (
    id SERIAL PRIMARY KEY,
    subject_id INTEGER NOT NULL,
    title VARCHAR(255) NOT NULL,
    file_path VARCHAR(255) NOT NULL,
    uploaded_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (subject_id) REFERENCES subjects(id) ON DELETE CASCADE
);

-- ASSIGNMENTS TABLE (for homework/tasks)
CREATE TABLE assignments (
    id SERIAL PRIMARY KEY,
    subject_id INTEGER NOT NULL,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    due_date DATE,
    FOREIGN KEY (subject_id) REFERENCES subjects(id) ON DELETE CASCADE
);

-- SUBMISSIONS TABLE (for students' submitted assignments)
CREATE TABLE submissions (
    id SERIAL PRIMARY KEY,
    assignment_id INTEGER NOT NULL,
    user_id INTEGER NOT NULL,
    file_path VARCHAR(255) NOT NULL,
    submitted_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    grade VARCHAR(10),
    feedback TEXT,
    FOREIGN KEY (assignment_id) REFERENCES assignments(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);




-- Insert sample subjects with teachers (assuming you have some teacher users)
INSERT INTO subjects (name, description, teacher_id) VALUES
('Angleščina', 'Učenje angleškega jezika in literature', NULL),
('Slovenščina', 'Učenje slovenskega jezika in literature', NULL),
('Matematika', 'Matematični predmet z osnovnimi in naprednimi koncepti', NULL),
('Sociologija', 'Preučevanje družbe in družbenih pojavov', NULL),
('SMV', 'Svetovna in medkulturna vzgoja', NULL),
('NUP', 'Načrtovanje in upravljanje proizvodnje', NULL),
('NRP', 'Načrtovanje in razvoj proizvodov', NULL),
('RPR', 'Računalniška podpora razvoju', NULL),
('ŠVZ', 'Športna in zdravstvena vzgoja', NULL);

-- If you have teacher users, you can update the teacher_id like this:
-- UPDATE subjects SET teacher_id = (SELECT id FROM users WHERE status = 'Teacher' LIMIT 1) WHERE name = 'Angleščina';
